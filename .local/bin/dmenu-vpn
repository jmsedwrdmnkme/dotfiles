#!/bin/bash

openvpn="$XDG_CONFIG_HOME/openvpn"
cache="$XDG_CACHE_HOME/openvpn"
password="$(pass Password)"

cd $openvpn

[ -e "${cache}" ] && \
  echo $password | sudo -S -k -b pkill openvpn && \
  dunstify -h string:x-dunst-stack-tag:vpn "VPN disconnected" && \
  rm "$cache" && \
  exit

choice="$(find $openvpn -type f -name "*.conf" | sort -n | dmenu -i -l 10 -p "VPN server:")" 

openvpn --auth-user-pass --config $choice > $cache && \ 
dunstify -h string:x-dunst-stack-tag:vpn "VPN connecting..."
