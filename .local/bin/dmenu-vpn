#!/bin/bash

openvpn="/etc/openvpn"
password="$(pass Password)"

cd $openvpn

disconnect() {
  echo "$password" | sudo -S -k -b pkill openvpn && \
  dunstify -h string:x-dunst-stack-tag:vpn "VPN disconnected" && \
  exit
}

connect() {
  choice="$(find $openvpn -type f -name "*.conf" | sort -n | dmenu -i -l 10 -p "VPN server:")" 
  echo "$password" | sudo -S -k -b openvpn --config $choice > /dev/null && \ 
  dunstify -h string:x-dunst-stack-tag:vpn "VPN connecting..."
}

choice=$(printf "connect\ndisconnect" | dmenu -i -p "VPN:")

case "$choice" in
  connect) connect;;
  disconnect) disconnect;;
esac
